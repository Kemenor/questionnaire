<div class="page">
  <header class="hero">
    <div class="hero__inner">
      <p class="eyebrow">E-Auto Umfrage</p>
      <h1>Umfrage und Aufklärung zur E-Mobilität</h1>
      <p class="lead">
        Bitte beantworten Sie die folgenden Fragen ehrlich und spontan. Es gibt keine richtigen oder falschen Antworten.
        Die Daten werden anonym gespeichert und nur für Forschungszwecke verwendet.
      </p>
    </div>
  </header>

  <main class="card">
    <div *ngIf="loading" class="loading">
      <div class="spinner"></div>
      <p>Creating Cookie...</p>
    </div>

    <ng-container *ngIf="!loading">

      <div *ngIf="statusMessage" class="status">{{ statusMessage }}</div>
      <div *ngIf="errorMessage" class="error">{{ errorMessage }}</div>

      <section *ngIf="phase === 'phase1'" class="section">
        <div class="section__header">
          <h2>Phase 1</h2>
          <div class="progress">
            {{ answeredCount(phase1Answers, phase1Questions) }} /
            {{ totalQuestions(phase1Questions) }} answered
          </div>
        </div>

        <div class="question" *ngFor="let question of phase1Questions; index as idx">
          <div class="prompt">{{ idx + 1 }}. {{ question.prompt }}</div>
          <div class="options">
            <label *ngFor="let option of question.options" class="option">
              <input
                type="radio"
                [name]="'phase1-' + question.id"
                [value]="option"
                [(ngModel)]="phase1Answers[question.id]"
              />
              <span>{{ option }}</span>
            </label>
          </div>
        </div>

        <button class="primary" [disabled]="isSaving" (click)="submitPhase1()">
          Speichern und zum Video gehen
        </button>
      </section>

      <section *ngIf="phase === 'video'" class="section">
        <div class="section__header">
          <h2>Bitte schauen sie sich das kurze Informationsvideo an</h2>
          <p>Nachdem sie fertig sind kommen nochmals 10 Fragen.</p>
        </div>

        <div class="video">
          <video *ngIf="selectedVideo?.url" controls [src]="selectedVideo?.url"></video>
          <div *ngIf="!selectedVideo?.url" class="video__placeholder">
            Add your two video URLs in <code>src/app/app.ts</code>.
          </div>
        </div>

        <button class="primary" [disabled]="isSaving" (click)="markVideoWatched()">
          Ich habe das Video angesehen
        </button>
      </section>

      <section *ngIf="phase === 'phase2'" class="section">
        <div class="section__header">
          <h2>Phase 2</h2>
          <p>Answer the same 15 questions again. Change anything that feels different.</p>
          <div class="progress">
            {{ answeredCount(phase2Answers, phase2Questions) }} /
            {{ totalQuestions(phase2Questions) }} answered
          </div>
        </div>

        <div class="question" *ngFor="let question of phase2Questions; index as idx">
          <div class="prompt">{{ idx + 1 }}. {{ question.prompt }}</div>
          <div class="options">
            <label *ngFor="let option of question.options" class="option">
              <input
                type="radio"
                [name]="'phase2-' + question.id"
                [value]="option"
                [(ngModel)]="phase2Answers[question.id]"
              />
              <span>{{ option }}</span>
            </label>
          </div>
        </div>

        <button class="primary" [disabled]="isSaving" (click)="submitPhase2()">
          Speichern und abschließen
        </button>
      </section>

      <section *ngIf="phase === 'done'" class="section">
        <div class="section__header">
          <h2>Fertig</h2>
          <p>Ihre Antworten wurden gespeichert. Vielen Dank.</p>
        </div>

        <div class="summary" *ngIf="changedQuestions().length">
          <h3>Änderungen Ihrer Antworten</h3>
          <ul>
            <li *ngFor="let question of changedQuestions()">
              {{ question.prompt }}
              <span class="change">
                {{ phase1Answers[question.id] }} -> {{ phase2Answers[question.id] }}
              </span>
            </li>
          </ul>
        </div>

        <div class="summary" *ngIf="!changedQuestions().length">
          <h3>Keine Änderungen</h3>
          <p>Alle Antworten sind gleichgebleben.</p>
        </div>
      </section>
    </ng-container>
  </main>
</div>
